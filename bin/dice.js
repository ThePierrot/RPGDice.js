function Dice(a){this.type=a}function RdDice(a,b){Dice.call(this,a),this.sides=b}function diceParse(a){switch(diceType=a.slice(0,3),diceContent=a.substring(3),output="",diceType){case".rd":return result=rdParse(diceContent),result?rdPrinter(result):"";default:return""}}function rdParse(a){var b,c,d,e,f,g,h,i,j;if(syntax=a.match(/^\s\d{0,2}d\d{0,3}((\s*(\+|-)\s*\d{0,2}d\d{0,3})|(\s*(\+|-)\s*\d{0,3}))*/g)){if(b=a.substring(syntax[0].length),c=0,d=0,e=[],f=syntax[0].match(/(^\s*\d+d\d+)|((\+|-)(\s*\d+d\d+))|((\+|-)\s*\d+)/g),b.length&&(b=b.match(/[^\s].+/)[0]),f.length>10)return"";for(g=0;g<f.length;g++)if("+"===f[g].charAt(0))if(f[g].match(/\d+d\d+/g)){for(h=f[g].match(/\d+/g),results=rdRollDices(parseInt(h[0]),parseInt(h[1])),i2=0;i2<results.length;i2++)c+=results[i2];e=e.concat(results)}else bonusVal=parseInt(f[g].match(/\d+/g)),d+=bonusVal,c+=bonusVal;else if("-"===f[g].charAt(0))if(f[g].match(/\d+d\d+/g)){for(h=f[g].match(/\d+/g),results=rdRollDices(h[0],h[1]),i=0;i<results.length;i++)c-=results[i];e=e.concat(results)}else bonusVal=parseInt(f[g].match(/\d+/g)),d-=bonusVal,c-=bonusVal;else{for(h=f[g].match(/\d+/g),results=rdRollDices(parseInt(h[0]),parseInt(h[1])),i4=0;i4<results.length;i4++)c+=results[i4];e=e.concat(results)}return j={sum:c,bonus:d,comment:b,resultCollection:e}}return""}function rdRollDices(a,b){var d,c=[];for(d=0;a>d;d++)c.push(new RdDice("rd",b).roll());return c}function rdPrinter(a){var c,d,b="";if(a.comment&&(b+="因为：",b+=a.comment+"，"),b+="骰机发出了奇怪的响声，随后吐出了：",a.resultCollection.length>=50){for(c=0;50>c;c++)b+=a.resultCollection[c]+", ";b+="......你丢的骰子太多了！骰机懒得全部列出。"}else for(d=0;d<a.resultCollection.length;d++)b+=a.resultCollection[d]+", ";return a.bonus?(b+="你的总加值为：",b+=a.bonus,b+="，点数总和为："):b+="点数总和为：",b+=a.sum+"。"}var diceInput=Blaysiel.input;RdDice.prototype.roll=function(){return 10==this.sides||100==this.sides?Math.floor(Math.random()*this.sides):Math.floor(Math.random()*this.sides+1)},Iturya.output=diceParse(diceInput);
